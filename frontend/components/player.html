<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spotify Player</title>
    <script src="https://sdk.scdn.co/spotify-player.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1DB954 0%, #191414 100%);
            color: white;
            padding: 20px;
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            box-sizing: border-box;
        }
        .player-container {
            background: rgba(0, 0, 0, 0.8);
            border-radius: 15px;
            padding: 30px;
            width: 100%;
            max-width: 350px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        .album-art {
            width: 200px;
            height: 200px;
            border-radius: 10px;
            margin: 0 auto 20px;
            background-color: #333;
            background-size: cover;
            background-position: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        .track-info {
            margin-bottom: 20px;
        }
        .track-name {
            font-size: 1.4em;
            font-weight: bold;
            margin-bottom: 5px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .track-artist {
            font-size: 1em;
            color: #b3b3b3;
        }
        .controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin: 20px 0;
        }
        button {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            font-size: 1.5em;
            transition: transform 0.1s;
        }
        button:hover {
            transform: scale(1.1);
            color: #1DB954;
        }
        .play-btn {
            font-size: 2.5em;
            background: #1DB954;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: black;
        }
        .play-btn:hover {
            background: #1ed760;
            color: black;
        }
        .volume-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-top: 15px;
        }
        input[type=range] {
            width: 100px;
            accent-color: #1DB954;
        }
        .status {
            margin-top: 15px;
            font-size: 0.8em;
            color: #b3b3b3;
        }
    </style>
</head>
<body>
    <div class="player-container">
        <div class="album-art" id="album-art" style="background-image: url('https://via.placeholder.com/200x200?text=No+Image');"></div>
        
        <div class="track-info">
            <div class="track-name" id="track-name">Ïû¨ÏÉùÌï† Í≥°ÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</div>
            <div class="track-artist" id="track-artist">-</div>
        </div>
        
        <div class="controls">
            <button onclick="player.previousTrack()">‚èÆÔ∏è</button>
            <button class="play-btn" onclick="togglePlay()" id="play-btn">‚ñ∂</button>
            <button onclick="player.nextTrack()">‚è≠Ô∏è</button>
        </div>

        <div class="volume-container">
            <span>üîà</span>
            <input type="range" min="0" max="100" value="50" id="volume-slider" oninput="setVolume(this.value)">
            <span>üîä</span>
        </div>
        
        <div class="status" id="status">Spotify Ïó∞Í≤∞ Ï§ë...</div>
    </div>

    <script>
        const ACCESS_TOKEN = "{{ACCESS_TOKEN}}";
        const INITIAL_TRACK_URI = "{{INITIAL_TRACK_URI}}";
        
        let player;
        let deviceId;
        let isPlaying = false;

        window.onSpotifyWebPlaybackSDKReady = () => {
            player = new Spotify.Player({
                name: 'Streamlit Web Player',
                getOAuthToken: cb => { cb(ACCESS_TOKEN); },
                volume: 0.5
            });

            player.addListener('ready', ({ device_id }) => {
                console.log('Ready with Device ID', device_id);
                deviceId = device_id;
                document.getElementById('status').textContent = '‚úÖ Ïó∞Í≤∞Îê®';
                
                if (INITIAL_TRACK_URI) {
                    playTrack(INITIAL_TRACK_URI);
                }
            });

            player.addListener('not_ready', ({ device_id }) => {
                console.log('Device ID has gone offline', device_id);
                document.getElementById('status').textContent = '‚ùå Ïó∞Í≤∞ ÎÅäÍπÄ';
            });

            player.addListener('player_state_changed', state => {
                if (!state) return;
                
                const track = state.track_window.current_track;
                document.getElementById('track-name').textContent = track.name;
                document.getElementById('track-artist').textContent = track.artists.map(a => a.name).join(', ');
                
                // Ïï®Î≤î Ïù¥ÎØ∏ÏßÄ ÏóÖÎç∞Ïù¥Ìä∏
                const images = track.album.images;
                if (images && images.length > 0) {
                    // Í∞ÄÏû• ÌÅ∞ Ïù¥ÎØ∏ÏßÄ ÏÇ¨Ïö© (Î≥¥ÌÜµ Ï≤´ Î≤àÏß∏)
                    document.getElementById('album-art').style.backgroundImage = `url('${images[0].url}')`;
                }
                
                isPlaying = !state.paused;
                document.getElementById('play-btn').textContent = isPlaying ? '‚è∏' : '‚ñ∂';
            });

            player.connect();
        };

        function togglePlay() {
            player.togglePlay();
        }

        function setVolume(val) {
            player.setVolume(val / 100);
        }

        function playTrack(uri) {
            fetch(`https://api.spotify.com/v1/me/player/play?device_id=${deviceId}`, {
                method: 'PUT',
                body: JSON.stringify({ uris: [uri] }),
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${ACCESS_TOKEN}`
                },
            });
        }
    </script>
</body>
</html>
